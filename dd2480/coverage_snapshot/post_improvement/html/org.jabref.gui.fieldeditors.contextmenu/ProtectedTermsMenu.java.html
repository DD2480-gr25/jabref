<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sv"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProtectedTermsMenu.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JabRef</a> &gt; <a href="index.source.html" class="el_package">org.jabref.gui.fieldeditors.contextmenu</a> &gt; <span class="el_source">ProtectedTermsMenu.java</span></div><h1>ProtectedTermsMenu.java</h1><pre class="source lang-java linenums">package org.jabref.gui.fieldeditors.contextmenu;

import java.util.Objects;
import java.util.Optional;

import javafx.scene.control.Menu;
import javafx.scene.control.MenuItem;
import javafx.scene.control.SeparatorMenuItem;
import javafx.scene.control.TextInputControl;

import org.jabref.gui.Globals;
import org.jabref.gui.actions.Action;
import org.jabref.gui.actions.ActionFactory;
import org.jabref.gui.actions.SimpleCommand;
import org.jabref.gui.icon.IconTheme;
import org.jabref.gui.icon.JabRefIcon;
import org.jabref.logic.cleanup.Formatter;
import org.jabref.logic.formatter.casechanger.ProtectTermsFormatter;
import org.jabref.logic.l10n.Localization;
import org.jabref.logic.protectedterms.ProtectedTermsList;

class ProtectedTermsMenu extends Menu {

<span class="nc" id="L24">    private static final Formatter FORMATTER = new ProtectTermsFormatter(Globals.protectedTermsLoader);</span>
    private final TextInputControl textInputControl;
<span class="nc" id="L26">    private final ActionFactory factory = new ActionFactory(Globals.getKeyPrefs());</span>

<span class="nc" id="L28">    private final Action protectSelectionActionInformation = new Action() {</span>
        @Override
        public String getText() {
<span class="nc" id="L31">            return Localization.lang(&quot;Protect selection&quot;);</span>
        }

        @Override
        public Optional&lt;JabRefIcon&gt; getIcon() {
<span class="nc" id="L36">            return Optional.of(IconTheme.JabRefIcons.PROTECT_STRING);</span>
        }

        @Override
        public String getDescription() {
<span class="nc" id="L41">            return Localization.lang(&quot;Add {} around selected text&quot;);</span>
        }
    };

    private class ProtectSelectionAction extends SimpleCommand {
<span class="nc" id="L46">        ProtectSelectionAction() {</span>
<span class="nc" id="L47">            this.executable.bind(textInputControl.selectedTextProperty().isNotEmpty());</span>
<span class="nc" id="L48">        }</span>

        @Override
        public void execute() {
<span class="nc" id="L52">            String selectedText = textInputControl.getSelectedText();</span>
<span class="nc" id="L53">            textInputControl.replaceSelection(&quot;{&quot; + selectedText + &quot;}&quot;);</span>
<span class="nc" id="L54">        }</span>
    }

    private class FormatFieldAction extends SimpleCommand {
<span class="nc" id="L58">        FormatFieldAction() {</span>
<span class="nc" id="L59">            this.executable.bind(textInputControl.textProperty().isNotEmpty());</span>
<span class="nc" id="L60">        }</span>

        @Override
        public void execute() {
<span class="nc" id="L64">            textInputControl.setText(FORMATTER.format(textInputControl.getText()));</span>
<span class="nc" id="L65">        }</span>
    }

    private class AddToProtectedTermsAction extends SimpleCommand {
        ProtectedTermsList list;

<span class="nc" id="L71">        public AddToProtectedTermsAction(ProtectedTermsList list) {</span>
<span class="nc" id="L72">            Objects.requireNonNull(list);</span>

<span class="nc" id="L74">            this.list = list;</span>
<span class="nc" id="L75">            this.executable.bind(textInputControl.selectedTextProperty().isNotEmpty());</span>
<span class="nc" id="L76">        }</span>

        @Override
        public void execute() {
<span class="nc" id="L80">            list.addProtectedTerm(textInputControl.getSelectedText());</span>
<span class="nc" id="L81">        }</span>
    }

    public ProtectedTermsMenu(final TextInputControl textInputControl) {
<span class="nc" id="L85">        super(Localization.lang(&quot;Protect terms&quot;));</span>
<span class="nc" id="L86">        this.textInputControl = textInputControl;</span>

<span class="nc" id="L88">        getItems().addAll(factory.createMenuItem(protectSelectionActionInformation, new ProtectSelectionAction()),</span>
<span class="nc" id="L89">                getExternalFilesMenu(),</span>
                new SeparatorMenuItem(),
<span class="nc" id="L91">                factory.createMenuItem(() -&gt; Localization.lang(&quot;Format field&quot;), new FormatFieldAction()));</span>
<span class="nc" id="L92">    }</span>

    private Menu getExternalFilesMenu() {
<span class="nc" id="L95">        Menu protectedTermsMenu = factory.createSubMenu(() -&gt; Localization.lang(&quot;Add selected text to list&quot;));</span>

<span class="nc" id="L97">        Globals.protectedTermsLoader.getProtectedTermsLists().stream()</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">                                    .filter(list -&gt; !list.isInternalList())</span>
<span class="nc" id="L99">                                    .forEach(list -&gt; protectedTermsMenu.getItems().add(</span>
<span class="nc" id="L100">                                            factory.createMenuItem(list::getDescription, new AddToProtectedTermsAction(list))));</span>

<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (protectedTermsMenu.getItems().isEmpty()) {</span>
<span class="nc" id="L103">            MenuItem emptyItem = new MenuItem(Localization.lang(&quot;No list enabled&quot;));</span>
<span class="nc" id="L104">            emptyItem.setDisable(true);</span>
<span class="nc" id="L105">            protectedTermsMenu.getItems().add(emptyItem);</span>
        }

<span class="nc" id="L108">        return protectedTermsMenu;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>