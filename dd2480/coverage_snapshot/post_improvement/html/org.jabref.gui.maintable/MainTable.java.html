<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sv"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MainTable.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JabRef</a> &gt; <a href="index.source.html" class="el_package">org.jabref.gui.maintable</a> &gt; <span class="el_source">MainTable.java</span></div><h1>MainTable.java</h1><pre class="source lang-java linenums">package org.jabref.gui.maintable;

import java.io.File;
import java.io.IOException;
import java.nio.file.Path;
import java.util.List;
import java.util.Objects;
import java.util.Optional;
import java.util.stream.Collectors;

import javax.swing.undo.UndoManager;

import javafx.collections.ListChangeListener;
import javafx.scene.control.SelectionMode;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableRow;
import javafx.scene.control.TableView;
import javafx.scene.input.ClipboardContent;
import javafx.scene.input.DragEvent;
import javafx.scene.input.Dragboard;
import javafx.scene.input.KeyCode;
import javafx.scene.input.KeyEvent;
import javafx.scene.input.MouseDragEvent;
import javafx.scene.input.MouseEvent;
import javafx.scene.input.TransferMode;

import org.jabref.gui.DialogService;
import org.jabref.gui.DragAndDropDataFormats;
import org.jabref.gui.Globals;
import org.jabref.gui.LibraryTab;
import org.jabref.gui.StateManager;
import org.jabref.gui.actions.StandardActions;
import org.jabref.gui.edit.EditAction;
import org.jabref.gui.externalfiles.ImportHandler;
import org.jabref.gui.externalfiletype.ExternalFileTypes;
import org.jabref.gui.keyboard.KeyBinding;
import org.jabref.gui.keyboard.KeyBindingRepository;
import org.jabref.gui.maintable.columns.LibraryColumn;
import org.jabref.gui.maintable.columns.MainTableColumn;
import org.jabref.gui.util.ControlHelper;
import org.jabref.gui.util.CustomLocalDragboard;
import org.jabref.gui.util.DefaultTaskExecutor;
import org.jabref.gui.util.ViewModelTableRowFactory;
import org.jabref.logic.importer.ImportCleanup;
import org.jabref.logic.l10n.Localization;
import org.jabref.logic.util.OS;
import org.jabref.model.database.BibDatabaseContext;
import org.jabref.model.database.BibDatabaseMode;
import org.jabref.model.database.event.EntriesAddedEvent;
import org.jabref.model.entry.BibEntry;
import org.jabref.preferences.PreferencesService;

import com.google.common.eventbus.Subscribe;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class MainTable extends TableView&lt;BibEntryTableViewModel&gt; {

<span class="nc" id="L59">    private static final Logger LOGGER = LoggerFactory.getLogger(MainTable.class);</span>

    private final LibraryTab libraryTab;
    private final DialogService dialogService;
    private final StateManager stateManager;
    private final BibDatabaseContext database;
    private final MainTableDataModel model;

    private final ImportHandler importHandler;
    private final CustomLocalDragboard localDragboard;

    private long lastKeyPressTime;
    private String columnSearchTerm;

    public MainTable(MainTableDataModel model,
                     LibraryTab libraryTab,
                     BibDatabaseContext database,
                     PreferencesService preferencesService,
                     DialogService dialogService,
                     StateManager stateManager,
                     ExternalFileTypes externalFileTypes,
                     KeyBindingRepository keyBindingRepository) {
<span class="nc" id="L81">        super();</span>

<span class="nc" id="L83">        this.libraryTab = libraryTab;</span>
<span class="nc" id="L84">        this.dialogService = dialogService;</span>
<span class="nc" id="L85">        this.stateManager = stateManager;</span>
<span class="nc" id="L86">        this.database = Objects.requireNonNull(database);</span>
<span class="nc" id="L87">        this.model = model;</span>
<span class="nc" id="L88">        UndoManager undoManager = libraryTab.getUndoManager();</span>
<span class="nc" id="L89">        MainTablePreferences mainTablePreferences = preferencesService.getMainTablePreferences();</span>

<span class="nc" id="L91">        importHandler = new ImportHandler(</span>
                database, externalFileTypes,
                preferencesService,
<span class="nc" id="L94">                Globals.getFileUpdateMonitor(),</span>
                undoManager,
                stateManager);

<span class="nc" id="L98">        localDragboard = stateManager.getLocalDragboard();</span>

<span class="nc" id="L100">        this.setOnDragOver(this::handleOnDragOverTableView);</span>
<span class="nc" id="L101">        this.setOnDragDropped(this::handleOnDragDroppedTableView);</span>

<span class="nc" id="L103">        this.getColumns().addAll(</span>
                new MainTableColumnFactory(
                        database,
                        preferencesService,
<span class="nc" id="L107">                        preferencesService.getColumnPreferences(),</span>
                        externalFileTypes,
<span class="nc" id="L109">                        libraryTab.getUndoManager(),</span>
                        dialogService,
<span class="nc" id="L111">                        stateManager).createColumns());</span>

<span class="nc" id="L113">        this.getColumns().removeIf(col -&gt; col instanceof LibraryColumn);</span>

<span class="nc" id="L115">        new ViewModelTableRowFactory&lt;BibEntryTableViewModel&gt;()</span>
<span class="nc" id="L116">                .withOnMouseClickedEvent((entry, event) -&gt; {</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">                    if (event.getClickCount() == 2) {</span>
<span class="nc" id="L118">                        libraryTab.showAndEdit(entry.getEntry());</span>
                    }
<span class="nc" id="L120">                })</span>
<span class="nc" id="L121">                .withContextMenu(entry -&gt; RightClickMenu.create(entry,</span>
                        keyBindingRepository,
                        libraryTab,
                        dialogService,
                        stateManager,
                        preferencesService,
                        undoManager,
<span class="nc" id="L128">                        Globals.getClipboardManager(),</span>
                        Globals.TASK_EXECUTOR))
<span class="nc" id="L130">                .setOnDragDetected(this::handleOnDragDetected)</span>
<span class="nc" id="L131">                .setOnDragDropped(this::handleOnDragDropped)</span>
<span class="nc" id="L132">                .setOnDragOver(this::handleOnDragOver)</span>
<span class="nc" id="L133">                .setOnDragExited(this::handleOnDragExited)</span>
<span class="nc" id="L134">                .setOnMouseDragEntered(this::handleOnDragEntered)</span>
<span class="nc" id="L135">                .install(this);</span>

<span class="nc" id="L137">        this.getSortOrder().clear();</span>

        /* KEEP for debugging purposes
        for (var colModel : mainTablePreferences.getColumnPreferences().getColumnSortOrder()) {
            for (var col : this.getColumns()) {
                var tablecColModel = ((MainTableColumn&lt;?&gt;) col).getModel();
                if (tablecColModel.equals(colModel)) {
                    LOGGER.debug(&quot;Adding sort order for col {} &quot;, col);
                    this.getSortOrder().add(col);
                    break;
                }
            }
        }
        */

<span class="nc" id="L152">        mainTablePreferences.getColumnPreferences().getColumnSortOrder().forEach(columnModel -&gt;</span>
<span class="nc" id="L153">                this.getColumns().stream()</span>
<span class="nc" id="L154">                    .map(column -&gt; (MainTableColumn&lt;?&gt;) column)</span>
<span class="nc" id="L155">                    .filter(column -&gt; column.getModel().equals(columnModel))</span>
<span class="nc" id="L156">                    .findFirst()</span>
<span class="nc" id="L157">                    .ifPresent(column -&gt; this.getSortOrder().add(column)));</span>

<span class="nc bnc" id="L159" title="All 2 branches missed.">        if (mainTablePreferences.getResizeColumnsToFit()) {</span>
<span class="nc" id="L160">            this.setColumnResizePolicy(new SmartConstrainedResizePolicy());</span>
        }

<span class="nc" id="L163">        this.getSelectionModel().setSelectionMode(SelectionMode.MULTIPLE);</span>

<span class="nc" id="L165">        this.setItems(model.getEntriesFilteredAndSorted());</span>

        // Enable sorting
<span class="nc" id="L168">        model.getEntriesFilteredAndSorted().comparatorProperty().bind(this.comparatorProperty());</span>

<span class="nc" id="L170">        this.getStylesheets().add(MainTable.class.getResource(&quot;MainTable.css&quot;).toExternalForm());</span>

        // Store visual state
<span class="nc" id="L173">        new PersistenceVisualStateTable(this, preferencesService);</span>

<span class="nc" id="L175">        setupKeyBindings(keyBindingRepository);</span>

<span class="nc" id="L177">        this.setOnKeyTyped(key -&gt; {</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (this.getSortOrder().isEmpty()) {</span>
<span class="nc" id="L179">                return;</span>
            }
<span class="nc" id="L181">            this.jumpToSearchKey(getSortOrder().get(0), key);</span>
<span class="nc" id="L182">        });</span>

<span class="nc" id="L184">        database.getDatabase().registerListener(this);</span>
<span class="nc" id="L185">    }</span>

    /**
     * This is called, if a user starts typing some characters into the keyboard with focus on main table. The {@link MainTable} will scroll to the cell with the same starting column value and typed string
     *
     * @param sortedColumn The sorted column in {@link MainTable}
     * @param keyEvent     The pressed character
     */

    private void jumpToSearchKey(TableColumn&lt;BibEntryTableViewModel, ?&gt; sortedColumn, KeyEvent keyEvent) {
<span class="nc bnc" id="L195" title="All 4 branches missed.">        if ((keyEvent.getCharacter() == null) || (sortedColumn == null)) {</span>
<span class="nc" id="L196">            return;</span>
        }

<span class="nc bnc" id="L199" title="All 2 branches missed.">        if ((System.currentTimeMillis() - lastKeyPressTime) &lt; 700) {</span>
<span class="nc" id="L200">            columnSearchTerm += keyEvent.getCharacter().toLowerCase();</span>
        } else {
<span class="nc" id="L202">            columnSearchTerm = keyEvent.getCharacter().toLowerCase();</span>
        }

<span class="nc" id="L205">        lastKeyPressTime = System.currentTimeMillis();</span>

<span class="nc" id="L207">        this.getItems().stream()</span>
<span class="nc" id="L208">            .filter(item -&gt; Optional.ofNullable(sortedColumn.getCellObservableValue(item).getValue())</span>
<span class="nc" id="L209">                                    .map(Object::toString)</span>
<span class="nc" id="L210">                                    .orElse(&quot;&quot;)</span>
<span class="nc" id="L211">                                    .toLowerCase()</span>
<span class="nc" id="L212">                                    .startsWith(columnSearchTerm))</span>
<span class="nc" id="L213">            .findFirst()</span>
<span class="nc" id="L214">            .ifPresent(item -&gt; {</span>
<span class="nc" id="L215">                this.scrollTo(item);</span>
<span class="nc" id="L216">                this.clearAndSelect(item.getEntry());</span>
<span class="nc" id="L217">            });</span>
<span class="nc" id="L218">    }</span>

    @Subscribe
    public void listen(EntriesAddedEvent event) {
<span class="nc" id="L222">        DefaultTaskExecutor.runInJavaFXThread(() -&gt; clearAndSelect(event.getFirstEntry()));</span>
<span class="nc" id="L223">    }</span>

    public void clearAndSelect(BibEntry bibEntry) {
<span class="nc" id="L226">        findEntry(bibEntry).ifPresent(entry -&gt; {</span>
<span class="nc" id="L227">            getSelectionModel().clearSelection();</span>
<span class="nc" id="L228">            getSelectionModel().select(entry);</span>
<span class="nc" id="L229">            scrollTo(entry);</span>
<span class="nc" id="L230">        });</span>
<span class="nc" id="L231">    }</span>

    public void copy() {
<span class="nc" id="L234">        List&lt;BibEntry&gt; selectedEntries = getSelectedEntries();</span>

<span class="nc bnc" id="L236" title="All 2 branches missed.">        if (!selectedEntries.isEmpty()) {</span>
            try {
<span class="nc" id="L238">                Globals.getClipboardManager().setContent(selectedEntries);</span>
<span class="nc" id="L239">                dialogService.notify(libraryTab.formatOutputMessage(Localization.lang(&quot;Copied&quot;), selectedEntries.size()));</span>
<span class="nc" id="L240">            } catch (IOException e) {</span>
<span class="nc" id="L241">                LOGGER.error(&quot;Error while copying selected entries to clipboard&quot;, e);</span>
<span class="nc" id="L242">            }</span>
        }
<span class="nc" id="L244">    }</span>

    public void cut() {
<span class="nc" id="L247">        copy();</span>
<span class="nc" id="L248">        libraryTab.delete(true);</span>
<span class="nc" id="L249">    }</span>

    private void setupKeyBindings(KeyBindingRepository keyBindings) {
<span class="nc" id="L252">        this.addEventHandler(KeyEvent.KEY_PRESSED, event -&gt; {</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">            if (event.getCode() == KeyCode.ENTER) {</span>
<span class="nc" id="L254">                getSelectedEntries().stream()</span>
<span class="nc" id="L255">                                    .findFirst()</span>
<span class="nc" id="L256">                                    .ifPresent(libraryTab::showAndEdit);</span>
<span class="nc" id="L257">                event.consume();</span>
<span class="nc" id="L258">                return;</span>
            }

<span class="nc" id="L261">            Optional&lt;KeyBinding&gt; keyBinding = keyBindings.mapToKeyBinding(event);</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">            if (keyBinding.isPresent()) {</span>
<span class="nc bnc" id="L263" title="All 7 branches missed.">                switch (keyBinding.get()) {</span>
                    case SELECT_FIRST_ENTRY:
<span class="nc" id="L265">                        clearAndSelectFirst();</span>
<span class="nc" id="L266">                        event.consume();</span>
<span class="nc" id="L267">                        break;</span>
                    case SELECT_LAST_ENTRY:
<span class="nc" id="L269">                        clearAndSelectLast();</span>
<span class="nc" id="L270">                        event.consume();</span>
<span class="nc" id="L271">                        break;</span>
                    case PASTE:
<span class="nc bnc" id="L273" title="All 2 branches missed.">                        if (!OS.OS_X) {</span>
<span class="nc" id="L274">                            new EditAction(StandardActions.PASTE, libraryTab.frame(), stateManager).execute();</span>
                        }
<span class="nc" id="L276">                        event.consume();</span>
<span class="nc" id="L277">                        break;</span>
                    case COPY:
<span class="nc" id="L279">                        new EditAction(StandardActions.COPY, libraryTab.frame(), stateManager).execute();</span>
<span class="nc" id="L280">                        event.consume();</span>
<span class="nc" id="L281">                        break;</span>
                    case CUT:
<span class="nc" id="L283">                        new EditAction(StandardActions.CUT, libraryTab.frame(), stateManager).execute();</span>
<span class="nc" id="L284">                        event.consume();</span>
<span class="nc" id="L285">                        break;</span>
                    case DELETE_ENTRY:
<span class="nc" id="L287">                        new EditAction(StandardActions.DELETE_ENTRY, libraryTab.frame(), stateManager).execute();</span>
<span class="nc" id="L288">                        event.consume();</span>
<span class="nc" id="L289">                        break;</span>
                    default:
                        // Pass other keys to parent
                }
            }
<span class="nc" id="L294">        });</span>
<span class="nc" id="L295">    }</span>

    public void clearAndSelectFirst() {
<span class="nc" id="L298">        getSelectionModel().clearSelection();</span>
<span class="nc" id="L299">        getSelectionModel().selectFirst();</span>
<span class="nc" id="L300">        scrollTo(0);</span>
<span class="nc" id="L301">    }</span>

    private void clearAndSelectLast() {
<span class="nc" id="L304">        getSelectionModel().clearSelection();</span>
<span class="nc" id="L305">        getSelectionModel().selectLast();</span>
<span class="nc" id="L306">        scrollTo(getItems().size() - 1);</span>
<span class="nc" id="L307">    }</span>

    public void paste(BibDatabaseMode bibDatabaseMode) {
        // Find entries in clipboard
<span class="nc" id="L311">        List&lt;BibEntry&gt; entriesToAdd = Globals.getClipboardManager().extractData();</span>
<span class="nc" id="L312">        ImportCleanup cleanup = new ImportCleanup(bibDatabaseMode);</span>
<span class="nc" id="L313">        cleanup.doPostCleanup(entriesToAdd);</span>
<span class="nc" id="L314">        libraryTab.insertEntries(entriesToAdd);</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">        if (!entriesToAdd.isEmpty()) {</span>
<span class="nc" id="L316">            this.requestFocus();</span>
        }
<span class="nc" id="L318">    }</span>

    private void handleOnDragOver(TableRow&lt;BibEntryTableViewModel&gt; row, BibEntryTableViewModel item, DragEvent event) {
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (event.getDragboard().hasFiles()) {</span>
<span class="nc" id="L322">            event.acceptTransferModes(TransferMode.ANY);</span>
<span class="nc" id="L323">            ControlHelper.setDroppingPseudoClasses(row, event);</span>
        }
<span class="nc" id="L325">        event.consume();</span>
<span class="nc" id="L326">    }</span>

    private void handleOnDragOverTableView(DragEvent event) {
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (event.getDragboard().hasFiles()) {</span>
<span class="nc" id="L330">            event.acceptTransferModes(TransferMode.ANY);</span>
        }
<span class="nc" id="L332">        event.consume();</span>
<span class="nc" id="L333">    }</span>

    private void handleOnDragEntered(TableRow&lt;BibEntryTableViewModel&gt; row, BibEntryTableViewModel entry, MouseDragEvent event) {
        // Support the following gesture to select entries: click on one row -&gt; hold mouse button -&gt; move over other rows
        // We need to select all items between the starting row and the row where the user currently hovers the mouse over
        // It is not enough to just select the currently hovered row since then sometimes rows are not marked selected if the user moves to fast
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L340">        TableRow&lt;BibEntryTableViewModel&gt; sourceRow = (TableRow&lt;BibEntryTableViewModel&gt;) event.getGestureSource();</span>
<span class="nc" id="L341">        getSelectionModel().selectRange(sourceRow.getIndex(), row.getIndex());</span>
<span class="nc" id="L342">    }</span>

    private void handleOnDragExited(TableRow&lt;BibEntryTableViewModel&gt; row, BibEntryTableViewModel entry, DragEvent dragEvent) {
<span class="nc" id="L345">        ControlHelper.removeDroppingPseudoClasses(row);</span>
<span class="nc" id="L346">    }</span>

    private void handleOnDragDetected(TableRow&lt;BibEntryTableViewModel&gt; row, BibEntryTableViewModel entry, MouseEvent event) {
        // Start drag'n'drop
<span class="nc" id="L350">        row.startFullDrag();</span>

<span class="nc" id="L352">        List&lt;BibEntry&gt; entries = getSelectionModel().getSelectedItems().stream().map(BibEntryTableViewModel::getEntry).collect(Collectors.toList());</span>

        // The following is necesary to initiate the drag and drop in javafx, although we don't need the contents
        // It doesn't work without
<span class="nc" id="L356">        ClipboardContent content = new ClipboardContent();</span>
<span class="nc" id="L357">        Dragboard dragboard = startDragAndDrop(TransferMode.MOVE);</span>
<span class="nc" id="L358">        content.put(DragAndDropDataFormats.ENTRIES, &quot;&quot;);</span>
<span class="nc" id="L359">        dragboard.setContent(content);</span>

<span class="nc bnc" id="L361" title="All 2 branches missed.">        if (!entries.isEmpty()) {</span>
<span class="nc" id="L362">            localDragboard.putBibEntries(entries);</span>
        }

<span class="nc" id="L365">        event.consume();</span>
<span class="nc" id="L366">    }</span>

    private void handleOnDragDropped(TableRow&lt;BibEntryTableViewModel&gt; row, BibEntryTableViewModel target, DragEvent event) {
<span class="nc" id="L369">        boolean success = false;</span>

<span class="nc bnc" id="L371" title="All 2 branches missed.">        if (event.getDragboard().hasFiles()) {</span>
<span class="nc" id="L372">            List&lt;Path&gt; files = event.getDragboard().getFiles().stream().map(File::toPath).collect(Collectors.toList());</span>

            // Different actions depending on where the user releases the drop in the target row
            // Bottom + top -&gt; import entries
            // Center -&gt; link files to entry
            // Depending on the pressed modifier, move/copy/link files to drop target
<span class="nc bnc" id="L378" title="All 3 branches missed.">            switch (ControlHelper.getDroppingMouseLocation(row, event)) {</span>
<span class="nc" id="L379">                case TOP, BOTTOM -&gt; importHandler.importFilesInBackground(files).executeWith(Globals.TASK_EXECUTOR);</span>
                case CENTER -&gt; {
<span class="nc" id="L381">                    BibEntry entry = target.getEntry();</span>
<span class="nc bnc" id="L382" title="All 4 branches missed.">                    switch (event.getTransferMode()) {</span>
                        case LINK -&gt; {
<span class="nc" id="L384">                            LOGGER.debug(&quot;Mode LINK&quot;); // shift on win or no modifier</span>
<span class="nc" id="L385">                            importHandler.getLinker().addFilesToEntry(entry, files);</span>
<span class="nc" id="L386">                        }</span>
                        case MOVE -&gt; {
<span class="nc" id="L388">                            LOGGER.debug(&quot;Mode MOVE&quot;); // alt on win</span>
<span class="nc" id="L389">                            importHandler.getLinker().moveFilesToFileDirAndAddToEntry(entry, files, libraryTab.getIndexingTaskManager());</span>
<span class="nc" id="L390">                        }</span>
                        case COPY -&gt; {
<span class="nc" id="L392">                            LOGGER.debug(&quot;Mode Copy&quot;); // ctrl on win</span>
<span class="nc" id="L393">                            importHandler.getLinker().copyFilesToFileDirAndAddToEntry(entry, files, libraryTab.getIndexingTaskManager());</span>
                        }
                    }
                }
            }

<span class="nc" id="L399">            success = true;</span>
        }

<span class="nc" id="L402">        event.setDropCompleted(success);</span>
<span class="nc" id="L403">        event.consume();</span>
<span class="nc" id="L404">    }</span>

    private void handleOnDragDroppedTableView(DragEvent event) {
<span class="nc" id="L407">        boolean success = false;</span>

<span class="nc bnc" id="L409" title="All 2 branches missed.">        if (event.getDragboard().hasFiles()) {</span>
<span class="nc" id="L410">            List&lt;Path&gt; files = event.getDragboard().getFiles().stream().map(File::toPath).collect(Collectors.toList());</span>
<span class="nc" id="L411">            importHandler.importFilesInBackground(files).executeWith(Globals.TASK_EXECUTOR);</span>

<span class="nc" id="L413">            success = true;</span>
        }

<span class="nc" id="L416">        event.setDropCompleted(success);</span>
<span class="nc" id="L417">        event.consume();</span>
<span class="nc" id="L418">    }</span>

    public void addSelectionListener(ListChangeListener&lt;? super BibEntryTableViewModel&gt; listener) {
<span class="nc" id="L421">        getSelectionModel().getSelectedItems().addListener(listener);</span>
<span class="nc" id="L422">    }</span>

    public MainTableDataModel getTableModel() {
<span class="nc" id="L425">        return model;</span>
    }

    public BibEntry getEntryAt(int row) {
<span class="nc" id="L429">        return model.getEntriesFilteredAndSorted().get(row).getEntry();</span>
    }

    public List&lt;BibEntry&gt; getSelectedEntries() {
<span class="nc" id="L433">        return getSelectionModel()</span>
<span class="nc" id="L434">                .getSelectedItems()</span>
<span class="nc" id="L435">                .stream()</span>
<span class="nc" id="L436">                .map(BibEntryTableViewModel::getEntry)</span>
<span class="nc" id="L437">                .collect(Collectors.toList());</span>
    }

    private Optional&lt;BibEntryTableViewModel&gt; findEntry(BibEntry entry) {
<span class="nc" id="L441">        return model.getEntriesFilteredAndSorted()</span>
<span class="nc" id="L442">                    .stream()</span>
<span class="nc" id="L443">                    .filter(viewModel -&gt; viewModel.getEntry().equals(entry))</span>
<span class="nc" id="L444">                    .findFirst();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>