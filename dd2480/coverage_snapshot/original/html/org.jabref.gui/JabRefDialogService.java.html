<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JabRefDialogService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JabRef</a> &gt; <a href="index.source.html" class="el_package">org.jabref.gui</a> &gt; <span class="el_source">JabRefDialogService.java</span></div><h1>JabRefDialogService.java</h1><pre class="source lang-java linenums">package org.jabref.gui;

import java.io.File;
import java.io.IOException;
import java.nio.file.FileSystem;
import java.nio.file.FileSystems;
import java.nio.file.Path;
import java.util.Collection;
import java.util.Collections;
import java.util.List;
import java.util.Optional;
import java.util.function.Consumer;
import java.util.stream.Collectors;

import javafx.concurrent.Task;
import javafx.print.PrinterJob;
import javafx.scene.Group;
import javafx.scene.Node;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.control.Button;
import javafx.scene.control.ButtonBar;
import javafx.scene.control.ButtonType;
import javafx.scene.control.CheckBox;
import javafx.scene.control.ChoiceDialog;
import javafx.scene.control.DialogPane;
import javafx.scene.control.Label;
import javafx.scene.control.TextInputDialog;
import javafx.scene.layout.Pane;
import javafx.scene.layout.Region;
import javafx.scene.layout.VBox;
import javafx.stage.DirectoryChooser;
import javafx.stage.FileChooser;
import javafx.stage.Stage;
import javafx.stage.Window;
import javafx.util.Duration;

import org.jabref.gui.icon.IconTheme;
import org.jabref.gui.theme.ThemeManager;
import org.jabref.gui.util.BackgroundTask;
import org.jabref.gui.util.BaseDialog;
import org.jabref.gui.util.DirectoryDialogConfiguration;
import org.jabref.gui.util.FileDialogConfiguration;
import org.jabref.gui.util.ZipFileChooser;
import org.jabref.logic.l10n.Localization;

import com.jfoenix.controls.JFXSnackbar;
import com.jfoenix.controls.JFXSnackbar.SnackbarEvent;
import com.jfoenix.controls.JFXSnackbarLayout;
import com.tobiasdiez.easybind.EasyBind;
import org.controlsfx.control.TaskProgressView;
import org.controlsfx.dialog.ExceptionDialog;
import org.controlsfx.dialog.ProgressDialog;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * This class provides methods to create default
 * JavaFX dialogs which will also work on top of Swing
 * windows. The created dialogs are instances of the
 * {@link FXDialog} class. The available dialogs in this class
 * are useful for displaying small information graphic dialogs
 * rather than complex windows. For more complex dialogs it is
 * advised to rather create a new sub class of {@link FXDialog}.
 */
public class JabRefDialogService implements DialogService {
    // Snackbar dialog maximum size
    public static final int DIALOG_SIZE_LIMIT = 300;

<span class="fc" id="L69">    private static final Duration TOAST_MESSAGE_DISPLAY_TIME = Duration.millis(3000);</span>
<span class="fc" id="L70">    private static final Logger LOGGER = LoggerFactory.getLogger(JabRefDialogService.class);</span>

    private final Window mainWindow;
    private final JFXSnackbar statusLine;
    private final ThemeManager themeManager;

<span class="nc" id="L76">    public JabRefDialogService(Window mainWindow, Pane mainPane, ThemeManager themeManager) {</span>
<span class="nc" id="L77">        this.mainWindow = mainWindow;</span>
<span class="nc" id="L78">        this.themeManager = themeManager;</span>
<span class="nc" id="L79">        this.statusLine = new JFXSnackbar(mainPane);</span>
<span class="nc" id="L80">    }</span>

    private FXDialog createDialog(AlertType type, String title, String content) {
<span class="nc" id="L83">        FXDialog alert = new FXDialog(type, title, true);</span>
<span class="nc" id="L84">        themeManager.installCss(alert.getDialogPane().getScene());</span>
<span class="nc" id="L85">        alert.setHeaderText(null);</span>
<span class="nc" id="L86">        alert.setContentText(content);</span>
<span class="nc" id="L87">        alert.getDialogPane().setMinHeight(Region.USE_PREF_SIZE);</span>
<span class="nc" id="L88">        alert.initOwner(mainWindow);</span>
<span class="nc" id="L89">        return alert;</span>
    }

    private FXDialog createDialogWithOptOut(AlertType type, String title, String content,
                                            String optOutMessage, Consumer&lt;Boolean&gt; optOutAction) {
<span class="nc" id="L94">        FXDialog alert = new FXDialog(type, title, true);</span>
        // Need to force the alert to layout in order to grab the graphic as we are replacing the dialog pane with a custom pane
<span class="nc" id="L96">        alert.getDialogPane().applyCss();</span>
<span class="nc" id="L97">        Node graphic = alert.getDialogPane().getGraphic();</span>

        // Create a new dialog pane that has a checkbox instead of the hide/show details button
        // Use the supplied callback for the action of the checkbox
<span class="nc" id="L101">        alert.setDialogPane(new DialogPane() {</span>

            @Override
            protected Node createDetailsButton() {
<span class="nc" id="L105">                CheckBox optOut = new CheckBox();</span>
<span class="nc" id="L106">                optOut.setText(optOutMessage);</span>
<span class="nc" id="L107">                optOut.setOnAction(e -&gt; optOutAction.accept(optOut.isSelected()));</span>
<span class="nc" id="L108">                return optOut;</span>
            }
        });

        // Fool the dialog into thinking there is some expandable content; a group won't take up any space if it has no children
<span class="nc" id="L113">        alert.getDialogPane().setExpandableContent(new Group());</span>
<span class="nc" id="L114">        alert.getDialogPane().setExpanded(true);</span>

        // Reset the dialog graphic using the default style
<span class="nc" id="L117">        alert.getDialogPane().setGraphic(graphic);</span>
<span class="nc" id="L118">        themeManager.installCss(alert.getDialogPane().getScene());</span>
<span class="nc" id="L119">        alert.setHeaderText(null);</span>
<span class="nc" id="L120">        alert.setContentText(content);</span>
<span class="nc" id="L121">        alert.getDialogPane().setMinHeight(Region.USE_PREF_SIZE);</span>
<span class="nc" id="L122">        alert.initOwner(mainWindow);</span>
<span class="nc" id="L123">        return alert;</span>
    }

    public static String shortenDialogMessage(String dialogMessage) {
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">        if (dialogMessage.length() &lt; JabRefDialogService.DIALOG_SIZE_LIMIT) {</span>
<span class="fc" id="L128">            return dialogMessage.trim();</span>
        }
<span class="nc" id="L130">        return (dialogMessage.substring(0, Math.min(dialogMessage.length(), JabRefDialogService.DIALOG_SIZE_LIMIT)) + &quot;...&quot;).trim();</span>
    }

    @Override
    public &lt;T&gt; Optional&lt;T&gt; showChoiceDialogAndWait(String title, String content, String okButtonLabel, T defaultChoice, Collection&lt;T&gt; choices) {
<span class="nc" id="L135">        ChoiceDialog&lt;T&gt; choiceDialog = new ChoiceDialog&lt;&gt;(defaultChoice, choices);</span>
<span class="nc" id="L136">        ((Stage) choiceDialog.getDialogPane().getScene().getWindow()).getIcons().add(IconTheme.getJabRefImage());</span>
<span class="nc" id="L137">        ButtonType okButtonType = new ButtonType(okButtonLabel, ButtonBar.ButtonData.OK_DONE);</span>
<span class="nc" id="L138">        choiceDialog.getDialogPane().getButtonTypes().setAll(ButtonType.CANCEL, okButtonType);</span>
<span class="nc" id="L139">        choiceDialog.setHeaderText(title);</span>
<span class="nc" id="L140">        choiceDialog.setTitle(title);</span>
<span class="nc" id="L141">        choiceDialog.setContentText(content);</span>
<span class="nc" id="L142">        choiceDialog.initOwner(mainWindow);</span>
<span class="nc" id="L143">        themeManager.installCss(choiceDialog.getDialogPane().getScene());</span>
<span class="nc" id="L144">        return choiceDialog.showAndWait();</span>
    }

    @Override
    public Optional&lt;String&gt; showInputDialogAndWait(String title, String content) {
<span class="nc" id="L149">        TextInputDialog inputDialog = new TextInputDialog();</span>
<span class="nc" id="L150">        inputDialog.setHeaderText(title);</span>
<span class="nc" id="L151">        inputDialog.setContentText(content);</span>
<span class="nc" id="L152">        inputDialog.initOwner(mainWindow);</span>
<span class="nc" id="L153">        themeManager.installCss(inputDialog.getDialogPane().getScene());</span>
<span class="nc" id="L154">        return inputDialog.showAndWait();</span>
    }

    @Override
    public Optional&lt;String&gt; showInputDialogWithDefaultAndWait(String title, String content, String defaultValue) {
<span class="nc" id="L159">        TextInputDialog inputDialog = new TextInputDialog(defaultValue);</span>
<span class="nc" id="L160">        inputDialog.setHeaderText(title);</span>
<span class="nc" id="L161">        inputDialog.setContentText(content);</span>
<span class="nc" id="L162">        inputDialog.initOwner(mainWindow);</span>
<span class="nc" id="L163">        themeManager.installCss(inputDialog.getDialogPane().getScene());</span>
<span class="nc" id="L164">        return inputDialog.showAndWait();</span>
    }

    @Override
    public void showInformationDialogAndWait(String title, String content) {
<span class="nc" id="L169">        FXDialog alert = createDialog(AlertType.INFORMATION, title, content);</span>
<span class="nc" id="L170">        alert.showAndWait();</span>
<span class="nc" id="L171">    }</span>

    @Override
    public void showWarningDialogAndWait(String title, String content) {
<span class="nc" id="L175">        FXDialog alert = createDialog(AlertType.WARNING, title, content);</span>
<span class="nc" id="L176">        alert.showAndWait();</span>
<span class="nc" id="L177">    }</span>

    @Override
    public void showErrorDialogAndWait(String title, String content) {
<span class="nc" id="L181">        FXDialog alert = createDialog(AlertType.ERROR, title, content);</span>
<span class="nc" id="L182">        alert.showAndWait();</span>
<span class="nc" id="L183">    }</span>

    @Override
    public void showErrorDialogAndWait(String message, Throwable exception) {
<span class="nc" id="L187">        ExceptionDialog exceptionDialog = new ExceptionDialog(exception);</span>
<span class="nc" id="L188">        exceptionDialog.getDialogPane().setMaxWidth(mainWindow.getWidth() / 2);</span>
<span class="nc" id="L189">        exceptionDialog.setHeaderText(message);</span>
<span class="nc" id="L190">        exceptionDialog.initOwner(mainWindow);</span>
<span class="nc" id="L191">        themeManager.installCss(exceptionDialog.getDialogPane().getScene());</span>
<span class="nc" id="L192">        exceptionDialog.showAndWait();</span>
<span class="nc" id="L193">    }</span>

    @Override
    public void showErrorDialogAndWait(String title, String content, Throwable exception) {
<span class="nc" id="L197">        ExceptionDialog exceptionDialog = new ExceptionDialog(exception);</span>
<span class="nc" id="L198">        exceptionDialog.setHeaderText(title);</span>
<span class="nc" id="L199">        exceptionDialog.setContentText(content);</span>
<span class="nc" id="L200">        exceptionDialog.initOwner(mainWindow);</span>
<span class="nc" id="L201">        themeManager.installCss(exceptionDialog.getDialogPane().getScene());</span>
<span class="nc" id="L202">        exceptionDialog.showAndWait();</span>
<span class="nc" id="L203">    }</span>

    @Override
    public void showErrorDialogAndWait(String message) {
<span class="nc" id="L207">        FXDialog alert = createDialog(AlertType.ERROR, Localization.lang(&quot;Error Occurred&quot;), message);</span>
<span class="nc" id="L208">        alert.showAndWait();</span>
<span class="nc" id="L209">    }</span>

    @Override
    public boolean showConfirmationDialogAndWait(String title, String content) {
<span class="nc" id="L213">        FXDialog alert = createDialog(AlertType.CONFIRMATION, title, content);</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">        return alert.showAndWait().filter(buttonType -&gt; buttonType == ButtonType.OK).isPresent();</span>
    }

    @Override
    public boolean showConfirmationDialogAndWait(String title, String content, String okButtonLabel) {
<span class="nc" id="L219">        FXDialog alert = createDialog(AlertType.CONFIRMATION, title, content);</span>
<span class="nc" id="L220">        ButtonType okButtonType = new ButtonType(okButtonLabel, ButtonBar.ButtonData.OK_DONE);</span>
<span class="nc" id="L221">        alert.getButtonTypes().setAll(ButtonType.CANCEL, okButtonType);</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">        return alert.showAndWait().filter(buttonType -&gt; buttonType == okButtonType).isPresent();</span>
    }

    @Override
    public boolean showConfirmationDialogAndWait(String title, String content,
                                                 String okButtonLabel, String cancelButtonLabel) {
<span class="nc" id="L228">        FXDialog alert = createDialog(AlertType.CONFIRMATION, title, content);</span>
<span class="nc" id="L229">        ButtonType okButtonType = new ButtonType(okButtonLabel, ButtonBar.ButtonData.OK_DONE);</span>
<span class="nc" id="L230">        ButtonType cancelButtonType = new ButtonType(cancelButtonLabel, ButtonBar.ButtonData.NO);</span>
<span class="nc" id="L231">        alert.getButtonTypes().setAll(okButtonType, cancelButtonType);</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">        return alert.showAndWait().filter(buttonType -&gt; buttonType == okButtonType).isPresent();</span>
    }

    @Override
    public boolean showConfirmationDialogWithOptOutAndWait(String title, String content,
                                                           String optOutMessage, Consumer&lt;Boolean&gt; optOutAction) {
<span class="nc" id="L238">        FXDialog alert = createDialogWithOptOut(AlertType.CONFIRMATION, title, content, optOutMessage, optOutAction);</span>
<span class="nc" id="L239">        alert.getButtonTypes().setAll(ButtonType.YES, ButtonType.NO);</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        return alert.showAndWait().filter(buttonType -&gt; buttonType == ButtonType.YES).isPresent();</span>
    }

    @Override
    public boolean showConfirmationDialogWithOptOutAndWait(String title, String content,
                                                           String okButtonLabel, String cancelButtonLabel,
                                                           String optOutMessage, Consumer&lt;Boolean&gt; optOutAction) {
<span class="nc" id="L247">        FXDialog alert = createDialogWithOptOut(AlertType.CONFIRMATION, title, content, optOutMessage, optOutAction);</span>
<span class="nc" id="L248">        ButtonType okButtonType = new ButtonType(okButtonLabel, ButtonBar.ButtonData.YES);</span>
<span class="nc" id="L249">        ButtonType cancelButtonType = new ButtonType(cancelButtonLabel, ButtonBar.ButtonData.NO);</span>
<span class="nc" id="L250">        alert.getButtonTypes().setAll(okButtonType, cancelButtonType);</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">        return alert.showAndWait().filter(buttonType -&gt; buttonType == okButtonType).isPresent();</span>
    }

    @Override
    public Optional&lt;ButtonType&gt; showCustomButtonDialogAndWait(AlertType type, String title, String content,
                                                              ButtonType... buttonTypes) {
<span class="nc" id="L257">        FXDialog alert = createDialog(type, title, content);</span>
<span class="nc" id="L258">        alert.getButtonTypes().setAll(buttonTypes);</span>
<span class="nc" id="L259">        return alert.showAndWait();</span>
    }

    @Override
    public Optional&lt;ButtonType&gt; showCustomDialogAndWait(String title, DialogPane contentPane,
                                                        ButtonType... buttonTypes) {
<span class="nc" id="L265">        FXDialog alert = new FXDialog(AlertType.NONE, title);</span>
<span class="nc" id="L266">        alert.setDialogPane(contentPane);</span>
<span class="nc" id="L267">        alert.getButtonTypes().setAll(buttonTypes);</span>
<span class="nc" id="L268">        alert.getDialogPane().setMinHeight(Region.USE_PREF_SIZE);</span>
<span class="nc" id="L269">        alert.setResizable(true);</span>
<span class="nc" id="L270">        alert.initOwner(mainWindow);</span>
<span class="nc" id="L271">        themeManager.installCss(alert.getDialogPane().getScene());</span>
<span class="nc" id="L272">        return alert.showAndWait();</span>
    }

    @Override
    public &lt;R&gt; Optional&lt;R&gt; showCustomDialogAndWait(javafx.scene.control.Dialog&lt;R&gt; dialog) {
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (dialog.getOwner() == null) {</span>
<span class="nc" id="L278">            dialog.initOwner(mainWindow);</span>
        }
<span class="nc" id="L280">        return dialog.showAndWait();</span>
    }

    @Override
    public &lt;V&gt; void showProgressDialog(String title, String content, Task&lt;V&gt; task) {
<span class="nc" id="L285">        ProgressDialog progressDialog = new ProgressDialog(task);</span>
<span class="nc" id="L286">        progressDialog.setHeaderText(null);</span>
<span class="nc" id="L287">        progressDialog.setTitle(title);</span>
<span class="nc" id="L288">        progressDialog.setContentText(content);</span>
<span class="nc" id="L289">        progressDialog.setGraphic(null);</span>
<span class="nc" id="L290">        ((Stage) progressDialog.getDialogPane().getScene().getWindow()).getIcons().add(IconTheme.getJabRefImage());</span>
<span class="nc" id="L291">        progressDialog.setOnCloseRequest(evt -&gt; task.cancel());</span>
<span class="nc" id="L292">        DialogPane dialogPane = progressDialog.getDialogPane();</span>
<span class="nc" id="L293">        dialogPane.getButtonTypes().add(ButtonType.CANCEL);</span>
<span class="nc" id="L294">        Button cancelButton = (Button) dialogPane.lookupButton(ButtonType.CANCEL);</span>
<span class="nc" id="L295">        cancelButton.setOnAction(evt -&gt; {</span>
<span class="nc" id="L296">            task.cancel();</span>
<span class="nc" id="L297">            progressDialog.close();</span>
<span class="nc" id="L298">        });</span>
<span class="nc" id="L299">        themeManager.installCss(progressDialog.getDialogPane().getScene());</span>
<span class="nc" id="L300">        progressDialog.initOwner(mainWindow);</span>
<span class="nc" id="L301">        progressDialog.show();</span>
<span class="nc" id="L302">    }</span>

    @Override
    public &lt;V&gt; Optional&lt;ButtonType&gt; showBackgroundProgressDialogAndWait(String title, String content, StateManager stateManager) {
<span class="nc" id="L306">        TaskProgressView&lt;Task&lt;?&gt;&gt; taskProgressView = new TaskProgressView&lt;&gt;();</span>
<span class="nc" id="L307">        EasyBind.bindContent(taskProgressView.getTasks(), stateManager.getBackgroundTasks());</span>
<span class="nc" id="L308">        taskProgressView.setRetainTasks(false);</span>
<span class="nc" id="L309">        taskProgressView.setGraphicFactory(BackgroundTask::getIcon);</span>

<span class="nc" id="L311">        Label message = new Label(content);</span>

<span class="nc" id="L313">        VBox box = new VBox(taskProgressView, message);</span>

<span class="nc" id="L315">        DialogPane contentPane = new DialogPane();</span>
<span class="nc" id="L316">        contentPane.setContent(box);</span>

<span class="nc" id="L318">        FXDialog alert = new FXDialog(AlertType.WARNING, title);</span>
<span class="nc" id="L319">        alert.setDialogPane(contentPane);</span>
<span class="nc" id="L320">        alert.getButtonTypes().setAll(ButtonType.YES, ButtonType.CANCEL);</span>
<span class="nc" id="L321">        alert.getDialogPane().setMinHeight(Region.USE_PREF_SIZE);</span>
<span class="nc" id="L322">        alert.setResizable(true);</span>
<span class="nc" id="L323">        alert.initOwner(mainWindow);</span>
<span class="nc" id="L324">        themeManager.installCss(alert.getDialogPane().getScene());</span>

<span class="nc" id="L326">        stateManager.getAnyTaskRunning().addListener((observable, oldValue, newValue) -&gt; {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">            if (!newValue) {</span>
<span class="nc" id="L328">                alert.setResult(ButtonType.YES);</span>
<span class="nc" id="L329">                alert.close();</span>
            }
<span class="nc" id="L331">        });</span>

<span class="nc" id="L333">        return alert.showAndWait();</span>
    }

    @Override
    public void notify(String message) {
<span class="nc" id="L338">        LOGGER.info(message);</span>
<span class="nc" id="L339">        statusLine.fireEvent(new SnackbarEvent(new JFXSnackbarLayout(message), TOAST_MESSAGE_DISPLAY_TIME, null));</span>
<span class="nc" id="L340">    }</span>

    @Override
    public Optional&lt;Path&gt; showFileSaveDialog(FileDialogConfiguration fileDialogConfiguration) {
<span class="nc" id="L344">        FileChooser chooser = getConfiguredFileChooser(fileDialogConfiguration);</span>
<span class="nc" id="L345">        File file = chooser.showSaveDialog(mainWindow);</span>
<span class="nc" id="L346">        Optional.ofNullable(chooser.getSelectedExtensionFilter()).ifPresent(fileDialogConfiguration::setSelectedExtensionFilter);</span>
<span class="nc" id="L347">        return Optional.ofNullable(file).map(File::toPath);</span>
    }

    @Override
    public Optional&lt;Path&gt; showFileOpenDialog(FileDialogConfiguration fileDialogConfiguration) {
<span class="nc" id="L352">        FileChooser chooser = getConfiguredFileChooser(fileDialogConfiguration);</span>
<span class="nc" id="L353">        File file = chooser.showOpenDialog(mainWindow);</span>
<span class="nc" id="L354">        Optional.ofNullable(chooser.getSelectedExtensionFilter()).ifPresent(fileDialogConfiguration::setSelectedExtensionFilter);</span>
<span class="nc" id="L355">        return Optional.ofNullable(file).map(File::toPath);</span>
    }

    @Override
    public Optional&lt;Path&gt; showDirectorySelectionDialog(DirectoryDialogConfiguration directoryDialogConfiguration) {
<span class="nc" id="L360">        DirectoryChooser chooser = getConfiguredDirectoryChooser(directoryDialogConfiguration);</span>
<span class="nc" id="L361">        File file = chooser.showDialog(mainWindow);</span>
<span class="nc" id="L362">        return Optional.ofNullable(file).map(File::toPath);</span>
    }

    @Override
    public List&lt;Path&gt; showFileOpenDialogAndGetMultipleFiles(FileDialogConfiguration fileDialogConfiguration) {
<span class="nc" id="L367">        FileChooser chooser = getConfiguredFileChooser(fileDialogConfiguration);</span>
<span class="nc" id="L368">        List&lt;File&gt; files = chooser.showOpenMultipleDialog(mainWindow);</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">        return files != null ? files.stream().map(File::toPath).collect(Collectors.toList()) : Collections.emptyList();</span>
    }

    private DirectoryChooser getConfiguredDirectoryChooser(DirectoryDialogConfiguration directoryDialogConfiguration) {
<span class="nc" id="L373">        DirectoryChooser chooser = new DirectoryChooser();</span>
<span class="nc" id="L374">        directoryDialogConfiguration.getInitialDirectory().map(Path::toFile).ifPresent(chooser::setInitialDirectory);</span>
<span class="nc" id="L375">        return chooser;</span>
    }

    private FileChooser getConfiguredFileChooser(FileDialogConfiguration fileDialogConfiguration) {
<span class="nc" id="L379">        FileChooser chooser = new FileChooser();</span>
<span class="nc" id="L380">        chooser.getExtensionFilters().addAll(fileDialogConfiguration.getExtensionFilters());</span>
<span class="nc" id="L381">        chooser.setSelectedExtensionFilter(fileDialogConfiguration.getDefaultExtension());</span>
<span class="nc" id="L382">        chooser.setInitialFileName(fileDialogConfiguration.getInitialFileName());</span>
<span class="nc" id="L383">        fileDialogConfiguration.getInitialDirectory().map(Path::toFile).ifPresent(chooser::setInitialDirectory);</span>
<span class="nc" id="L384">        return chooser;</span>
    }

    @Override
    public boolean showPrintDialog(PrinterJob job) {
<span class="nc" id="L389">        return job.showPrintDialog(mainWindow);</span>
    }

    @Override
    public Optional&lt;Path&gt; showFileOpenFromArchiveDialog(Path archivePath) throws IOException {
<span class="nc" id="L394">        try (FileSystem zipFile = FileSystems.newFileSystem(archivePath, (ClassLoader) null)) {</span>
<span class="nc" id="L395">            return new ZipFileChooser(zipFile).showAndWait();</span>
<span class="nc" id="L396">        } catch (NoClassDefFoundError exc) {</span>
<span class="nc" id="L397">            throw new IOException(&quot;Could not instantiate ZIP-archive reader.&quot;, exc);</span>
        }
    }

    @Override
    public void showCustomDialog(BaseDialog&lt;?&gt; aboutDialogView) {
<span class="nc bnc" id="L403" title="All 2 branches missed.">        if (aboutDialogView.getOwner() == null) {</span>
<span class="nc" id="L404">            aboutDialogView.initOwner(mainWindow);</span>
        }
<span class="nc" id="L406">        aboutDialogView.show();</span>
<span class="nc" id="L407">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>